<head>
<script type="module" src="src/index_indoor.js"></script>
<script src="//cdn.jsdelivr.net/npm/eruda"></script>
<script>eruda.init();</script>
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, minimum-scale=1, maximum-scale=1" />
<title>å®¤å…§ AR - æ­¥æ•¸è¿½è¹¤</title>
<link rel="stylesheet" href="src/style.css">
<style>
    /* é¡å¤–çš„å®¤å…§æ¨¡å¼æ¨£å¼ */
    #info-panel {
        max-height: 60vh;
        overflow-y: auto;
    }
    
    .step-info {
        background: rgba(0, 150, 255, 0.2);
        border-left: 3px solid #0096ff;
        padding: 8px;
        margin-top: 10px;
        border-radius: 4px;
    }
    
    #reset-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 15px 25px;
        background: #ff4444;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        z-index: 1000;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    
    #reset-btn:active {
        transform: scale(0.95);
    }
    
    .mode-badge {
        position: fixed;
        top: 10px;
        right: 10px;
        background: #00ff88;
        color: #000;
        padding: 8px 15px;
        border-radius: 20px;
        font-weight: bold;
        font-size: 12px;
        z-index: 1000;
    }
</style>
</head>
<body>
<main>

<!-- æ¨¡å¼æ¨™è¨˜ -->
<div class="mode-badge">ğŸ  å®¤å…§æ¨¡å¼</div>

<!-- è³‡è¨Šé¢æ¿ -->
<div id="info-panel">
    <div class="info-title">ğŸ“ ä½ç½®è³‡è¨Š</div>
    <div class="info-item">
        <span class="info-label">X åº§æ¨™:</span>
        <span class="info-value" id="lon-value">0.00 m</span>
    </div>
    <div class="info-item">
        <span class="info-label">Z åº§æ¨™:</span>
        <span class="info-value" id="lat-value">0.00 m</span>
    </div>
    <div class="info-item">
        <span class="info-label">æ­¥æ•¸:</span>
        <span class="info-value" id="grid-point">0</span>
    </div>
    <div class="step-info">
        <div style="font-size: 11px; color: #aaa; margin-bottom: 4px;">ğŸ’¡ æç¤º</div>
        <div style="font-size: 12px;">é–‹å§‹èµ°å‹•ä»¥è¿½è¹¤ä½ç½®<br>è¨Šè™Ÿåœ“åœˆæœƒå‡ºç¾åœ¨å›ºå®šä½ç½®</div>
    </div>
    <div id="grid-status">è¨Šè™Ÿé»æ•¸é‡: <span id="grid-count">0</span></div>
    
    <div class="info-section">
        <div class="info-title" style="font-size: 13px; margin-bottom: 6px;">ğŸ“¶ ç•¶å‰è¨Šè™Ÿ</div>
        <div class="info-item">
            <span class="info-label">è¨Šè™Ÿå¼·åº¦:</span>
            <span class="info-value" id="signal-strength" style="font-weight: bold;">--</span>
        </div>
        <div class="info-item">
            <span class="info-label">æœ€è¿‘è¨Šè™Ÿé»:</span>
            <span class="info-value" id="nearest-station" style="color: #ffcc00;">--</span>
        </div>
        <div class="info-item">
            <span class="info-label">è·é›¢:</span>
            <span class="info-value" id="station-distance">--</span>
        </div>
    </div>
</div>

<!-- è¨Šè™Ÿé»åˆ—è¡¨ -->
<div id="base-stations">
    <div class="info-title">ğŸ“¡ è¨Šè™Ÿé»ä½ç½®</div>
    <div class="station-item">
        <div class="station-name">è¨Šè™Ÿé» A</div>
        <div class="station-coords">æ­£å‰æ–¹ 5m (å¼·)</div>
    </div>
    <div class="station-item">
        <div class="station-name">è¨Šè™Ÿé» B</div>
        <div class="station-coords">å³å‰æ–¹ 5m (ä¸­)</div>
    </div>
    <div class="station-item">
        <div class="station-name">è¨Šè™Ÿé» C</div>
        <div class="station-coords">å·¦å‰æ–¹ 3m (è¼ƒå¼·)</div>
    </div>
    <div class="station-item">
        <div class="station-name">è¨Šè™Ÿé» D</div>
        <div class="station-coords">é å‰æ–¹ 10m (å¼±)</div>
    </div>
    <div class="station-item">
        <div class="station-name">è¨Šè™Ÿé» E</div>
        <div class="station-coords">å³å´ 5m (ä¸­)</div>
    </div>
    <div class="station-item">
        <div class="station-name">è¨Šè™Ÿé» F</div>
        <div class="station-coords">å·¦å´ 5m (è¼ƒä¸­)</div>
    </div>
    
    <div class="signal-legend">
        <div class="legend-item">
            <div class="color-box color-strong"></div>
            <span>å¼· (90+)</span>
        </div>
        <div class="legend-item">
            <div class="color-box color-high"></div>
            <span>è¼ƒå¼· (70-89)</span>
        </div>
        <div class="legend-item">
            <div class="color-box color-medium"></div>
            <span>ä¸­ (50-69)</span>
        </div>
        <div class="legend-item">
            <div class="color-box color-orange"></div>
            <span>è¼ƒå¼± (30-49)</span>
        </div>
        <div class="legend-item">
            <div class="color-box color-weak"></div>
            <span>å¼± (10-29)</span>
        </div>
        <div class="legend-item">
            <div class="color-box color-none"></div>
            <span>ç„¡ (&lt;10)</span>
        </div>
    </div>
</div>

<!-- å‡ä½ç½®è¼¸å…¥ (æ”¹ç‚ºé‡è¨­æŒ‰éˆ•) -->
<div id="gpsinput" style="display: none;">
    <div><input id="fakeLon" placeholder="X åº§æ¨™ (å…¬å°º)" value="0"/></div>
    <div><input id="fakeLat" placeholder="Z åº§æ¨™ (å…¬å°º)" value="0"/></div>
    <div><button id="setFakeLoc">é‡è¨­åˆ°åŸé»</button></div>
</div>

<!-- å¿«é€Ÿé‡è¨­æŒ‰éˆ• -->
<button id="reset-btn" onclick="document.getElementById('setFakeLoc').click()">
    ğŸ”„ é‡è¨­åŸé»
</button>

<!-- Three.js Canvas -->
<canvas id="glscene"></canvas>

</main>

<script>
    // é é¢è¼‰å…¥å®Œæˆå¾Œçš„é¡å¤–åˆå§‹åŒ–
    window.addEventListener('load', () => {
        console.log("âœ… å®¤å…§ AR é é¢å·²è¼‰å…¥");
        
        // æç¤ºä½¿ç”¨è€…æˆæ¬Šæ„Ÿæ¸¬å™¨
        setTimeout(() => {
            if (typeof DeviceMotionEvent !== 'undefined' && 
                typeof DeviceMotionEvent.requestPermission === 'function') {
                
                // iOS 13+ éœ€è¦ä½¿ç”¨è€…äº’å‹•ä¾†æˆæ¬Š
                const btn = document.createElement('button');
                btn.textContent = 'ğŸ¯ é–‹å§‹è¿½è¹¤';
                btn.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    padding: 20px 40px;
                    font-size: 20px;
                    background: #007AFF;
                    color: white;
                    border: none;
                    border-radius: 12px;
                    z-index: 10000;
                    cursor: pointer;
                `;
                
                btn.onclick = async () => {
                    try {
                        const permission = await DeviceMotionEvent.requestPermission();
                        if (permission === 'granted') {
                            btn.remove();
                            console.log("âœ… å‹•ä½œæ„Ÿæ¸¬å™¨å·²æˆæ¬Š");
                        }
                    } catch (error) {
                        alert('ç„¡æ³•æˆæ¬Šæ„Ÿæ¸¬å™¨: ' + error.message);
